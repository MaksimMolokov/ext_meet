(()=>{"use strict";let e=[];const t=new Map,r=new Map;function n(r){const n=t.get(r);if(!n)return;const o=new Date(n.startTime).toISOString(),i=new Date(n.endTime).toISOString();e.push(`[${o}] [${i}] ${n.speaker} : ${n.text}`.trim()),clearTimeout(n.timer),t.delete(r)}let o=".nMcdL",i=null;function c(e){const o=e.querySelector(".ygicle");if(!o)return;const i=e.querySelector(".NWpY1d")?.textContent?.trim()??" ",c=e.getAttribute("data-participant-id")||i,s=()=>{const e=o.textContent?.trim()??"";e&&function(e,o,i){const c=i.trim();if(!c)return;const s=c.toLowerCase().replace(/[.,?!'"\u2019]/g,"").replace(/\s+/g," ").trim();if(r.get(e)===s)return;r.set(e,s);const a=Date.now(),l=t.get(e);if(!l){const r=window.setTimeout(()=>n(e),2e3);return void t.set(e,{startTime:a,endTime:a,speaker:o,text:c,timer:r})}l.endTime=a,l.text=c,l.speaker=o,clearTimeout(l.timer),l.timer=window.setTimeout(()=>n(e),2e3)}(c,i,e)};s(),new MutationObserver(s).observe(o,{childList:!0,subtree:!0,characterData:!0})}new MutationObserver(()=>{const e=document.querySelector('div[role="region"][aria-label="Captions"]');e&&function(e){i?.disconnect(),i=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{e instanceof HTMLElement&&e.matches(o)&&c(e)})})}),i.observe(e,{childList:!0,subtree:!0}),console.log("Caption observer attached"),e.querySelectorAll(o).forEach(c)}(e)}).observe(document.body,{childList:!0,subtree:!0}),window.getTranscript=()=>([...t.keys()].forEach(n),e.join("\n")),window.resetTranscript=()=>{t.clear(),e.length=0},chrome.runtime.onMessage.addListener((r,o,i)=>"GET_TRANSCRIPT"===r?.type?([...t.keys()].forEach(n),i({transcript:e.join("\n")}),!0):"RESET_TRANSCRIPT"===r?.type?(t.clear(),e.length=0,i({ok:!0}),!0):void 0),console.log("Transcript collector ready")})();